<!DOCTYPE html>
<html lang="en"><head>
<meta charset="utf-8"/>
<meta content="width=device-width, initial-scale=1.0" name="viewport"/>
<title>Andexa - Chat with your data</title>
<link rel="icon" type="image/png" href="./static/Andexa2.png"/>
<script src="https://cdn.tailwindcss.com?plugins=forms,typography"></script>
<script src="https://cdn.plot.ly/plotly-2.30.1.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Sora:wght@300;400;600;700&amp;display=swap" rel="stylesheet"/>
<link href="https://fonts.googleapis.com/css2?family=Material+Symbols+Outlined" rel="stylesheet"/>
<!-- Prism.js for syntax highlighting -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/themes/prism-tomorrow.min.css" rel="stylesheet"/>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/components/prism-core.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.29.0/plugins/autoloader/prism-autoloader.min.js"></script>
<script>
        tailwind.config = {
            darkMode: "class",
            theme: {
                extend: {
                    colors: {
                        primary: "#1E5F74", // Deep blue from Andexa logo
                        "primary-dark": "#153E4D", // Darker blue for hover states
                        secondary: "#14B8A6", // Teal/cyan from Andexa logo
                        "secondary-dark": "#0D9488", // Darker teal for hover
                        "background-light": "#F5F5F5",
                        "background-dark": "#0A0A0A",
                        "surface-light": "#FFFFFF",
                        "surface-dark": "#1A1A1A",
                        "text-light": "#1A1A1A",
                        "text-dark": "#F5F5F5",
                        "accent-teal": "#17A2B8", // Accent teal
                        "accent-blue": "#2B6777", // Accent blue
                    },
                    fontFamily: {
                        display: ["Sora", "sans-serif"],
                    },
                    borderRadius: {
                        'DEFAULT': '0.75rem',
                        'lg': '1rem',
                        'xl': '1.5rem',
                    },
                },
            },
        };
    </script>

    <link rel="stylesheet" href="./static/css/app.css"/>
</head>
<body class="bg-background-light dark:bg-background-dark font-display text-text-light dark:text-text-dark transition-colors duration-300">
<!-- Mobile sidebar backdrop -->
<div id="sidebar-backdrop" class="sidebar-backdrop"></div>
<div class="flex h-screen relative">
<aside id="sidebar" class="sidebar-container w-72 bg-surface-light dark:bg-surface-dark shadow-lg relative z-20 border-r border-gray-200 dark:border-gray-700">
<div class="sidebar-content p-6 flex flex-col h-full">
<!-- Branding (Always Visible) -->
<div class="mb-6">
<div class="flex items-center space-x-3 mb-3">
<img alt="Andexa Logo" class="h-10 w-auto" src="./static/Andexa2.png"/>
</div>
<div class="flex items-center justify-start pl-1">
<img alt="KFSHRC Logo" class="h-17 w-auto" src="./static/KFSHRC.png"/>
</div>
</div>

<!-- Scrollable Sections Container -->
<div class="flex-1 overflow-y-auto space-y-4">
<!-- File Info Section (Accordion) -->
<div class="sidebar-section" data-section="file-info">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="file-info-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">description</span>
<h3 class="text-sm font-semibold">File Info</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="file-info-content" class="sidebar-section-content">
<div class="text-xs text-gray-500 dark:text-gray-400 space-y-2 mt-3">
<div class="flex justify-between">
<span>Rows:</span>
<span id="file-info-rows" class="font-medium text-text-light dark:text-text-dark">-</span>
</div>
<div class="flex justify-between">
<span>Columns:</span>
<span id="file-info-columns" class="font-medium text-text-light dark:text-text-dark">-</span>
</div>
<div class="flex justify-between">
<span>Size:</span>
<span id="file-info-size" class="font-medium text-text-light dark:text-text-dark">-</span>
</div>
</div>
</div>
</div>

<!-- Data Connectors Section (Accordion) -->
<div class="sidebar-section" data-section="connectors">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="connectors-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">cable</span>
<h3 class="text-sm font-semibold">Data Connectors</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="connectors-content" class="sidebar-section-content">
<!-- Connected Sources List -->
<div id="connected-sources" class="space-y-2">
<!-- Connected items will be dynamically added here -->
</div>

<!-- Connector Grid -->
<div class="connector-grid mt-4">
<button class="connector-card" data-connector="sql" onclick="openConnectorModal('sql')">
<div class="connector-icon connector-icon-sql">
<span class="material-symbols-outlined">database</span>
</div>
<span class="connector-name">SQL Database</span>
</button>

<button class="connector-card" data-connector="google-drive" onclick="openConnectorModal('google-drive')">
<div class="connector-icon connector-icon-gdrive">
<span class="material-symbols-outlined">add_to_drive</span>
</div>
<span class="connector-name">Google Drive</span>
</button>

<button class="connector-card" data-connector="onedrive" onclick="openConnectorModal('onedrive')">
<div class="connector-icon connector-icon-onedrive">
<span class="material-symbols-outlined">cloud_sync</span>
</div>
<span class="connector-name">OneDrive</span>
</button>

<button class="connector-card" data-connector="s3" onclick="openConnectorModal('s3')">
<div class="connector-icon connector-icon-s3">
<span class="material-symbols-outlined">cloud_circle</span>
</div>
<span class="connector-name">Amazon S3</span>
</button>

<button class="connector-card" data-connector="api" onclick="openConnectorModal('api')">
<div class="connector-icon connector-icon-api">
<span class="material-symbols-outlined">api</span>
</div>
<span class="connector-name">REST API</span>
</button>

<button class="connector-card" data-connector="ftp" onclick="openConnectorModal('ftp')">
<div class="connector-icon connector-icon-ftp">
<span class="material-symbols-outlined">folder_shared</span>
</div>
<span class="connector-name">FTP/SFTP</span>
</button>
</div>

<!-- Add Custom Connection Button -->
<button id="addConnectorBtn" class="w-full text-xs px-3 py-2.5 mt-4 bg-secondary text-white rounded-lg hover:bg-secondary-dark transition-all duration-200 flex items-center justify-center space-x-1.5 shadow-sm hover:shadow-md" onclick="openConnectorModal('custom')">
<span class="material-symbols-outlined text-sm">add_circle</span>
<span class="font-medium">Add Connection</span>
</button>
</div>
</div>

<!-- LLM Provider Section (Accordion) -->
<div class="sidebar-section" data-section="llm-provider">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="llm-provider-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">smart_toy</span>
<h3 class="text-sm font-semibold">LLM Provider</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="llm-provider-content" class="sidebar-section-content">
<div class="mt-3 space-y-2">
<!-- Provider dropdown -->
<select id="provider-select" class="w-full text-xs px-3 py-2 bg-gray-100 dark:bg-gray-700 text-gray-900 dark:text-gray-100 rounded border border-gray-200 dark:border-gray-600 focus:outline-none focus:ring-2 focus:ring-primary/20">
<option value="groq">Groq (Kimi K2) - Cloud</option>
<option value="lmstudio">LM Studio - Local</option>
<option value="zai">Z.AI (GLM 4.6) - Cloud</option>
</select>
<!-- Status indicator -->
<div class="flex items-center justify-between text-xs">
<span class="text-gray-500 dark:text-gray-400">Status:</span>
<span id="provider-status" class="flex items-center">
<span id="provider-status-dot" class="w-2 h-2 rounded-full bg-green-500 mr-1"></span>
<span id="provider-status-text">Connected</span>
</span>
</div>
</div>
</div>
</div>
<!-- Hidden legacy test mode toggle for backward compatibility -->
<input type="checkbox" id="test-mode-toggle" class="hidden">

<!-- Custom Rules Section (Accordion) -->
<div class="sidebar-section" data-section="custom-rules">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="custom-rules-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">rule</span>
<h3 class="text-sm font-semibold">Custom Rules</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="custom-rules-content" class="sidebar-section-content">
<button id="addRuleBtn" class="w-full text-xs px-3 py-2 mt-3 bg-primary text-white rounded hover:bg-primary-dark transition-colors flex items-center justify-center space-x-1">
<span class="material-symbols-outlined text-sm">add</span>
<span>Add Rule</span>
</button>
<div id="rulesContainer" class="text-xs text-gray-500 dark:text-gray-400 space-y-2 max-h-32 overflow-y-auto mt-3">
<p class="text-center py-2">No custom rules defined</p>
</div>
</div>
</div>

<!-- Recent Chats Section (Accordion) -->
<div class="sidebar-section" data-section="recent-chats">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="recent-chats-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">chat</span>
<h3 class="text-sm font-semibold">Recent Chats</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="recent-chats-content" class="sidebar-section-content">
<div id="recentChatsList" class="mt-3 space-y-2 max-h-48 overflow-y-auto">
<p class="text-center text-xs text-gray-500 dark:text-gray-400 py-4">No recent chats</p>
</div>
</div>
</div>

<!-- Settings Section (Accordion) -->
<div class="sidebar-section" data-section="settings">
<button class="sidebar-section-header" aria-expanded="true" aria-controls="settings-content">
<div class="flex items-center flex-1">
<span class="material-symbols-outlined mr-2 text-base">settings</span>
<h3 class="text-sm font-semibold">Settings</h3>
</div>
<span class="material-symbols-outlined chevron-icon">expand_more</span>
</button>
<div id="settings-content" class="sidebar-section-content">
<div class="mt-3 space-y-2 text-xs text-gray-500 dark:text-gray-400">
<p class="text-center py-2">Settings options coming soon</p>
</div>
</div>
</div>
</div>

<!-- New Chat Button (Always Visible at Bottom) -->
<div class="mt-4 pt-4 border-t border-gray-200 dark:border-gray-700">
<button id="newChatBtn" class="w-full bg-primary text-white py-3 px-4 rounded-lg flex items-center justify-center space-x-2 hover:bg-primary-dark transition-all duration-300">
<span class="material-symbols-outlined">add</span>
<span>New Chat</span>
</button>
</div>
</div>
</aside>
<main id="main-content" class="main-content flex-1 flex flex-col relative">
<header class="flex justify-between items-center p-4 relative z-30">
<!-- Sidebar Toggle Button -->
<button id="sidebar-toggle" class="p-2 text-gray-600 dark:text-gray-300 hover:text-primary dark:hover:text-primary hover:bg-gray-100 dark:hover:bg-gray-700 rounded-lg transition-all duration-200 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-opacity-50" aria-label="Toggle sidebar">
<span class="material-symbols-outlined text-2xl">menu</span>
</button>

<!-- Model Status -->
<div id="model-status" class="flex items-center space-x-2 bg-surface-light dark:bg-surface-dark px-4 py-3 rounded-lg shadow-lg border border-gray-200 dark:border-gray-600" title="Checking LM Studio status">
<span class="relative flex h-3 w-3 z-10">
<span id="model-status-ping" class="absolute inline-flex h-full w-full rounded-full opacity-75 hidden"></span>
<span id="model-status-dot" class="relative inline-flex rounded-full h-3 w-3 bg-gray-400"></span>
</span>
<span id="model-status-text" class="text-sm font-medium text-gray-700 dark:text-gray-300 whitespace-nowrap">Checking model...</span>
</div>
</header>
<div class="flex-1 flex flex-col items-center justify-center text-center px-6 md:px-8 lg:px-12 relative z-10" id="chat-start-view">
<div class="p-6 bg-surface-light dark:bg-surface-dark rounded-xl shadow-md mb-6">
<img alt="Andexa Logo" class="h-12 w-auto" src="./static/Andexa2.png"/>
</div>
<h2 class="text-3xl md:text-4xl font-bold text-gray-800 dark:text-white mb-2">How can I help you today?</h2>
<p class="text-gray-600 dark:text-gray-400 max-w-lg">Start by uploading a file or ask me a general question. I can help you with Excel files, documents, and more.</p>
<div class="grid grid-cols-1 md:grid-cols-2 gap-4 mt-12 w-full max-w-3xl">
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow duration-300">
<div class="flex items-center text-primary dark:text-primary mb-3">
<span class="material-symbols-outlined text-3xl">lightbulb</span>
<h3 class="font-semibold text-lg ml-2">Examples</h3>
</div>
<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">"Summarize the key findings from the attached sales report."</p>
<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">"Which product had the highest growth in Q4?"</p>
<p class="text-sm text-gray-600 dark:text-gray-400">"Create a bar chart showing sales by region."</p>
</div>
<div class="bg-surface-light dark:bg-surface-dark p-6 rounded-xl border border-gray-200 dark:border-gray-700 hover:shadow-lg transition-shadow duration-300">
<div class="flex items-center text-primary dark:text-primary mb-3">
<span class="material-symbols-outlined text-3xl">build_circle</span>
<h3 class="font-semibold text-lg ml-2">Capabilities</h3>
</div>
<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Understands complex queries about your data.</p>
<p class="text-sm text-gray-600 dark:text-gray-400 mb-4">Can generate charts and visualizations.</p>
<p class="text-sm text-gray-600 dark:text-gray-400">Supports multiple languages and file formats.</p>
</div>
</div>
</div>
<div id="upload-progress-container" class="hidden w-full px-6 md:px-8 lg:px-12 mt-6" role="status" aria-live="polite" aria-hidden="true">
<div class="max-w-3xl mx-auto bg-surface-light dark:bg-surface-dark border border-gray-200 dark:border-gray-700 rounded-xl shadow-sm p-4">
<div class="space-y-4">
<div>
<div class="flex items-center justify-between text-sm font-medium text-gray-600 dark:text-gray-300">
<span id="upload-progress-label">Upload</span>
<span id="upload-progress-percent">0%</span>
</div>
<p id="upload-progress-filename" class="text-xs text-gray-500 dark:text-gray-400 mt-1"></p>
<div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden mt-2">
<div id="upload-progress-bar" class="h-full bg-primary rounded-full transition-all duration-150" style="width:0%"></div>
</div>
</div>
<div id="processing-status" class="hidden space-y-2">
<div class="flex items-center justify-between text-sm font-medium text-gray-600 dark:text-gray-300">
<span id="processing-status-text">Processing...</span>
<span id="processing-status-indicator" class="flex items-center text-primary dark:text-primary">
<span id="processing-status-icon" class="material-symbols-outlined text-base">hourglass_top</span>
</span>
</div>
<div class="h-2 bg-gray-200 dark:bg-gray-700 rounded-full overflow-hidden">
<div id="processing-progress-bar" class="h-full bg-primary rounded-full opacity-80 animate-pulse"></div>
</div>
</div>
</div>
</div>
</div>
<div class="hidden flex-1 overflow-y-auto pb-4 px-4 relative z-10" id="chat-conversation-view">
</div>
<div class="mt-auto p-6 md:p-8 lg:p-12 pt-4 relative z-10">
<div class="premium-input-wrapper">
<div class="premium-input-container" id="input-container">
<div class="relative flex items-center gap-3 p-3">
<!-- Attach File Button -->
<button class="premium-attach-btn p-2.5 flex-shrink-0 z-20">
<label class="cursor-pointer flex items-center justify-center" for="file-upload">
<span class="material-symbols-outlined text-xl premium-icon text-gray-600 dark:text-gray-400">attach_file</span>
</label>
<input class="hidden" id="file-upload" type="file" accept=".csv,.xlsx,.xls"/>
</button>
<!-- Textarea -->
<textarea class="premium-textarea flex-1 py-2.5 px-1 max-h-32 overflow-y-auto" id="chat-input" placeholder="Ask a question or upload a file..." rows="1"></textarea>
        <!-- Voice Input Button -->
        <button id="mic-btn" class="premium-attach-btn p-2.5 flex-shrink-0 z-20" aria-pressed="false" aria-label="Start voice input" title="Voice input (Alt+R)">
          <span class="material-symbols-outlined text-xl premium-icon">mic</span>
        </button>

<!-- Send Button -->
<button id="send-btn" class="premium-send-btn text-white w-12 h-12 flex-shrink-0 flex items-center justify-center z-20">
<span class="material-symbols-outlined text-xl">send</span>
</button>
</div>
</div>
</div>
</div>
</main>
</div>


    <script defer src="./static/js/app.js"></script>
    <div id="notification-container" class="notification-container" aria-live="polite" aria-atomic="true"></div>

    <!-- Dashboard Modal -->
    <div id="dashboard-modal" class="hidden fixed inset-0 z-50 bg-black bg-opacity-50 flex items-center justify-center p-4" onclick="if(event.target === this) closeDashboardModal()">
        <div class="dashboard-modal-container bg-white dark:bg-surface-dark rounded-lg shadow-2xl overflow-hidden" onclick="event.stopPropagation()">
            <!-- Modal Header -->
            <div class="dashboard-header bg-primary dark:bg-primary-dark text-white px-6 py-4 flex justify-between items-center">
                <h2 id="dashboard-title" class="text-xl font-bold">Interactive Dashboard</h2>
                <div class="dashboard-controls flex items-center space-x-2">
                    <button
                        id="fullscreen-btn"
                        onclick="toggleDashboardFullscreen()"
                        class="px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-1"
                        title="Toggle fullscreen mode"
                    >
                        <span>‚õ∂</span>
                        <span>Fullscreen</span>
                    </button>
                    <div class="relative">
                        <button
                            id="export-menu-btn"
                            onclick="toggleExportDropdown()"
                            class="px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-1"
                            title="Export dashboard"
                        >
                            <span>‚§ì</span>
                            <span>Export</span>
                        </button>
                        <div id="export-dropdown" class="hidden absolute right-0 mt-2 w-48 bg-white dark:bg-surface-dark rounded-lg shadow-xl border border-gray-200 dark:border-gray-700 overflow-hidden z-10">
                            <button
                                onclick="exportDashboard('html')"
                                class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center space-x-2 transition-colors"
                            >
                                <span>üíæ</span>
                                <span>Download HTML</span>
                            </button>
                            <button
                                onclick="exportDashboard('pdf')"
                                class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center space-x-2 transition-colors"
                            >
                                <span>üìÑ</span>
                                <span>Download PDF</span>
                            </button>
                            <button
                                onclick="exportDashboard('png')"
                                class="w-full px-4 py-2 text-left hover:bg-gray-100 dark:hover:bg-gray-700 text-gray-700 dark:text-gray-300 flex items-center space-x-2 transition-colors"
                            >
                                <span>üñºÔ∏è</span>
                                <span>Download PNG</span>
                            </button>
                        </div>
                    </div>
                    <button
                        id="close-dashboard-btn"
                        onclick="closeDashboardModal()"
                        class="px-3 py-1.5 bg-white bg-opacity-20 hover:bg-opacity-30 rounded-lg text-sm font-medium transition-all duration-200 flex items-center space-x-1"
                        title="Close dashboard"
                    >
                        <span>‚úï</span>
                        <span>Close</span>
                    </button>
                </div>
            </div>

            <!-- Dashboard Content (iframe) -->
            <div class="dashboard-content-wrapper relative">
                <iframe
                    id="dashboard-iframe"
                    class="dashboard-frame"
                    sandbox="allow-scripts allow-same-origin allow-downloads"
                    title="Interactive Dashboard"
                ></iframe>

                <!-- Loading State -->
                <div id="dashboard-loading" class="hidden absolute inset-0 bg-white dark:bg-surface-dark bg-opacity-90 flex flex-col items-center justify-center">
                    <div class="animate-spin rounded-full h-16 w-16 border-b-4 border-primary mb-4"></div>
                    <p class="text-gray-700 dark:text-gray-300 font-medium">Generating dashboard...</p>
                    <p class="text-gray-500 dark:text-gray-400 text-sm mt-2">This may take a few seconds</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Add/Edit Rule Modal -->
    <div id="rule-modal" class="modal-overlay hidden">
        <div class="modal-container">
            <div class="modal-header">
                <h3 id="rule-modal-title" class="text-lg font-semibold">Add Custom Rule</h3>
                <button onclick="closeRuleModal()" class="modal-close-btn">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="rule-form" onsubmit="event.preventDefault(); saveRule();">
                    <div class="mb-4">
                        <label for="rule-text" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Rule Text <span class="text-red-500">*</span>
                        </label>
                        <textarea
                            id="rule-text"
                            rows="3"
                            maxlength="500"
                            required
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100"
                            placeholder="Enter your analysis rule or instruction..."></textarea>
                        <p class="text-xs text-gray-500 dark:text-gray-400 mt-1">
                            <span id="char-count">0</span>/500 characters
                        </p>
                    </div>
                    <div class="mb-4">
                        <label for="rule-category" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Category
                        </label>
                        <select
                            id="rule-category"
                            class="w-full px-3 py-2 border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-gray-100">
                            <option value="general">General</option>
                            <option value="analysis">Analysis</option>
                            <option value="visualization">Visualization</option>
                            <option value="formatting">Formatting</option>
                            <option value="data">Data Processing</option>
                        </select>
                    </div>
                    <div class="mb-4">
                        <label for="rule-priority" class="block text-sm font-medium text-gray-700 dark:text-gray-300 mb-2">
                            Priority: <span id="priority-value">3</span>
                        </label>
                        <input
                            type="range"
                            id="rule-priority"
                            min="1"
                            max="5"
                            value="3"
                            class="w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer dark:bg-gray-700">
                        <div class="flex justify-between text-xs text-gray-500 dark:text-gray-400 mt-1">
                            <span>Low</span>
                            <span>Medium</span>
                            <span>High</span>
                        </div>
                    </div>
                    <div class="flex justify-end space-x-3 mt-6">
                        <button
                            type="button"
                            onclick="closeRuleModal()"
                            class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                            Cancel
                        </button>
                        <button
                            type="submit"
                            id="rule-submit-btn"
                            class="px-4 py-2 text-sm font-medium text-white bg-primary rounded-lg hover:bg-primary-dark transition-colors flex items-center space-x-2">
                            <span class="material-symbols-outlined text-sm hidden" id="rule-submit-spinner">progress_activity</span>
                            <span id="rule-submit-text">Save Rule</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Connector Configuration Modal -->
    <div id="connector-modal" class="modal-overlay hidden">
        <div class="modal-container max-w-lg">
            <div class="modal-header">
                <div class="connector-modal-header">
                    <div id="connector-modal-icon" class="connector-modal-icon connector-icon-sql">
                        <span class="material-symbols-outlined">database</span>
                    </div>
                    <div>
                        <h3 id="connector-modal-title" class="text-lg font-semibold">Connect to SQL Database</h3>
                        <p id="connector-modal-subtitle" class="text-xs text-gray-500 dark:text-gray-400 mt-0.5">Configure your database connection</p>
                    </div>
                </div>
                <button onclick="closeConnectorModal()" class="modal-close-btn">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <form id="connector-form" onsubmit="event.preventDefault(); saveConnector();">
                    <!-- Connection Name -->
                    <div class="connector-form-group">
                        <label for="connector-name" class="connector-form-label">
                            Connection Name <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="connector-name"
                            class="connector-form-input"
                            placeholder="e.g., Production Database"
                            required
                        />
                        <p class="connector-form-hint">A friendly name to identify this connection</p>
                    </div>

                    <!-- SQL Database Type Selector (shown for SQL connector) -->
                    <div id="sql-type-selector" class="connector-form-group">
                        <label class="connector-form-label">Database Type</label>
                        <div class="db-type-selector">
                            <button type="button" class="db-type-pill selected" data-db-type="mysql" onclick="selectDbType('mysql')">
                                MySQL
                            </button>
                            <button type="button" class="db-type-pill" data-db-type="postgresql" onclick="selectDbType('postgresql')">
                                PostgreSQL
                            </button>
                            <button type="button" class="db-type-pill" data-db-type="sqlite" onclick="selectDbType('sqlite')">
                                SQLite
                            </button>
                            <button type="button" class="db-type-pill" data-db-type="mssql" onclick="selectDbType('mssql')">
                                SQL Server
                            </button>
                        </div>
                    </div>

                    <!-- Host/Server (for SQL databases) -->
                    <div id="host-group" class="connector-form-group">
                        <label for="connector-host" class="connector-form-label">
                            Host / Server <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="connector-host"
                            class="connector-form-input"
                            placeholder="localhost or 192.168.1.100"
                        />
                    </div>

                    <!-- Port (for SQL databases) -->
                    <div id="port-group" class="connector-form-group">
                        <label for="connector-port" class="connector-form-label">Port</label>
                        <input
                            type="number"
                            id="connector-port"
                            class="connector-form-input"
                            placeholder="3306"
                        />
                        <p class="connector-form-hint">Default: MySQL 3306, PostgreSQL 5432, SQL Server 1433</p>
                    </div>

                    <!-- Database Name -->
                    <div id="database-group" class="connector-form-group">
                        <label for="connector-database" class="connector-form-label">
                            Database Name <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="connector-database"
                            class="connector-form-input"
                            placeholder="my_database"
                        />
                    </div>

                    <!-- Username -->
                    <div id="username-group" class="connector-form-group">
                        <label for="connector-username" class="connector-form-label">Username</label>
                        <input
                            type="text"
                            id="connector-username"
                            class="connector-form-input"
                            placeholder="db_user"
                        />
                    </div>

                    <!-- Password -->
                    <div id="password-group" class="connector-form-group">
                        <label for="connector-password" class="connector-form-label">Password</label>
                        <div class="relative">
                            <input
                                type="password"
                                id="connector-password"
                                class="connector-form-input pr-10"
                                placeholder="Enter password"
                            />
                            <button
                                type="button"
                                onclick="togglePasswordVisibility()"
                                class="absolute right-3 top-1/2 -translate-y-1/2 text-gray-400 hover:text-gray-600 dark:hover:text-gray-300"
                            >
                                <span id="password-toggle-icon" class="material-symbols-outlined text-lg">visibility</span>
                            </button>
                        </div>
                    </div>

                    <!-- API Endpoint (for REST API connector) -->
                    <div id="api-endpoint-group" class="connector-form-group hidden">
                        <label for="connector-api-endpoint" class="connector-form-label">
                            API Endpoint URL <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="url"
                            id="connector-api-endpoint"
                            class="connector-form-input"
                            placeholder="https://api.example.com/v1/data"
                        />
                    </div>

                    <!-- API Key (for REST API connector) -->
                    <div id="api-key-group" class="connector-form-group hidden">
                        <label for="connector-api-key" class="connector-form-label">API Key</label>
                        <input
                            type="password"
                            id="connector-api-key"
                            class="connector-form-input"
                            placeholder="Your API key"
                        />
                    </div>

                    <!-- Bucket Name (for S3) -->
                    <div id="bucket-group" class="connector-form-group hidden">
                        <label for="connector-bucket" class="connector-form-label">
                            Bucket Name <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="connector-bucket"
                            class="connector-form-input"
                            placeholder="my-data-bucket"
                        />
                    </div>

                    <!-- Region (for S3) -->
                    <div id="region-group" class="connector-form-group hidden">
                        <label for="connector-region" class="connector-form-label">Region</label>
                        <select id="connector-region" class="connector-form-select">
                            <option value="us-east-1">US East (N. Virginia)</option>
                            <option value="us-west-2">US West (Oregon)</option>
                            <option value="eu-west-1">EU (Ireland)</option>
                            <option value="ap-southeast-1">Asia Pacific (Singapore)</option>
                            <option value="ap-northeast-1">Asia Pacific (Tokyo)</option>
                        </select>
                    </div>

                    <!-- Access Key (for S3) -->
                    <div id="access-key-group" class="connector-form-group hidden">
                        <label for="connector-access-key" class="connector-form-label">
                            Access Key ID <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="text"
                            id="connector-access-key"
                            class="connector-form-input"
                            placeholder="AKIAIOSFODNN7EXAMPLE"
                        />
                    </div>

                    <!-- Secret Key (for S3) -->
                    <div id="secret-key-group" class="connector-form-group hidden">
                        <label for="connector-secret-key" class="connector-form-label">
                            Secret Access Key <span class="text-red-500">*</span>
                        </label>
                        <input
                            type="password"
                            id="connector-secret-key"
                            class="connector-form-input"
                            placeholder="Your secret access key"
                        />
                    </div>

                    <!-- OAuth Button (for Google Drive, OneDrive) -->
                    <div id="oauth-group" class="connector-form-group hidden">
                        <button
                            type="button"
                            id="oauth-connect-btn"
                            class="w-full flex items-center justify-center gap-2 px-4 py-3 bg-primary text-white rounded-lg hover:bg-primary-dark transition-colors"
                            onclick="initiateOAuth()"
                        >
                            <span class="material-symbols-outlined text-lg">login</span>
                            <span>Sign in with Google</span>
                        </button>
                        <p class="connector-form-hint text-center mt-2">You will be redirected to authenticate</p>
                    </div>

                    <!-- Test Connection Button -->
                    <div class="connector-form-group">
                        <button type="button" class="test-connection-btn" onclick="testConnection()">
                            <span class="material-symbols-outlined text-base">lan</span>
                            <span>Test Connection</span>
                        </button>
                        <div id="connection-test-result" class="hidden"></div>
                    </div>

                    <!-- Form Actions -->
                    <div class="flex justify-end space-x-3 mt-6 pt-4 border-t border-gray-200 dark:border-gray-700">
                        <button
                            type="button"
                            onclick="closeConnectorModal()"
                            class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors"
                        >
                            Cancel
                        </button>
                        <button
                            type="submit"
                            id="connector-submit-btn"
                            class="px-4 py-2 text-sm font-medium text-white bg-secondary rounded-lg hover:bg-secondary-dark transition-colors flex items-center space-x-2"
                        >
                            <span class="material-symbols-outlined text-sm hidden" id="connector-submit-spinner">progress_activity</span>
                            <span id="connector-submit-text">Save Connection</span>
                        </button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Confirm Modal (for deletes and New Chat) -->
    <div id="confirm-modal" class="modal-overlay hidden">
        <div class="modal-container max-w-md">
            <div class="modal-header">
                <h3 id="confirm-modal-title" class="text-lg font-semibold">Confirm Action</h3>
                <button onclick="closeConfirmModal()" class="modal-close-btn">
                    <span class="material-symbols-outlined">close</span>
                </button>
            </div>
            <div class="modal-body">
                <p id="confirm-modal-message" class="text-gray-700 dark:text-gray-300 mb-6"></p>
                <div class="flex justify-end space-x-3">
                    <button
                        onclick="closeConfirmModal()"
                        class="px-4 py-2 text-sm font-medium text-gray-700 dark:text-gray-300 bg-gray-100 dark:bg-gray-700 rounded-lg hover:bg-gray-200 dark:hover:bg-gray-600 transition-colors">
                        Cancel
                    </button>
                    <button
                        id="confirm-modal-btn"
                        class="px-4 py-2 text-sm font-medium text-white bg-red-600 rounded-lg hover:bg-red-700 transition-colors">
                        Confirm
                    </button>
                </div>
            </div>
        </div>
    </div>
</body></html>


